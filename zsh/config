export EDITOR='vim'
export VIM_APP_DIR=/Applications
export PATH="/usr/local/heroku/bin:$HOME/bin:$HOME/.bin:$VIM_APP_DIR/bin:$VIM_APP_DIR/MacVim.app/Contents/MacOS:$(cd $(which gem)/..;pwd):/usr/local/homebrew/bin:/usr/local/bin:/usr/local/sbin:$PATH"
export NODE_PATH="/usr/local/lib/node_modules"
export CLICOLOR=1
export TERM=screen-256color
export PAGER=less

# Grab the current SSH agent if there is one
#export SSH_AUTH_SOCK=$(find '/tmp/ssh-*' -user $(whoami) -name agent\* 2>/dev/null |tail -1)
# The below needs to be adapted to compensate for forward agents
#[[ -n $(pgrep -U$UID ssh-agent) ]] && export SSH_AUTH_SOCK=$(find /tmp/ssh-* -user $(whoami) -name agent\* 2>/dev/null |tail -1)
# Add ssh keys (and start an agent if there isn't one already running)
#ssh-add 2>/dev/null; [[ $? -eq 2 ]] && eval $(ssh-agent) 1>/dev/null && ssh-add 2>/dev/null

# Fix SSH_AUTH_SOCK to a predicatable locaiton
SOCK="/tmp/ssh-agent-$USER-screen"
# && [ ${SOCK:0:15} != ${SSH_AUTH_SOCK:0:15} ]
if test $SSH_AUTH_SOCK && [ $SSH_AUTH_SOCK != $SOCK ]
then
    ln -sf $SSH_AUTH_SOCK $SOCK
    readlink $SSH_AUTH_SOCK > /dev/null || sudo chmod -R g+rwx $(dirname $SSH_AUTH_SOCK)
    export SSH_AUTH_SOCK=$SOCK
fi

[[ -s ~/.rvm/scripts/rvm ]] && source ~/.rvm/scripts/rvm
[[ -s /etc/profile ]] && source /etc/profile

# Map hh to vim-cmd-mode
bindkey -M viins 'hhh' vi-cmd-mode
# Map jj to vim-cmd-mode
bindkey -M viins 'jj' vi-cmd-mode
# Map kk to vim-cmd-mode
bindkey -M viins 'kkk' vi-cmd-mode
# Map ll to vim-cmd-mode
bindkey -M viins 'lll' vi-cmd-mode

# Allow editing of the text on the current command line with v (cmd mode)
autoload -U edit-command-line
zle -N edit-command-line
bindkey -M vicmd v edit-command-line

# We like the calculator built into the shell
autoload -U zcalc

# Auto pushd
setopt autocd autopushd pushdignoredups
bindkey -v

# Remap Ctrl-S to Ctrl-- for stopping termianl output
stty stop 

fpath=(~/.zsh/functions $fpath)

autoload -U ~/.zsh/functions/*(:t)

## Command history configuration
HISTFILE=$HOME/.zsh_history
HISTSIZE=10000
SAVEHIST=10000

setopt append_history
setopt extended_history
setopt hist_expire_dups_first
setopt hist_ignore_dups # ignore duplication command history list
setopt hist_ignore_space
setopt hist_reduce_blanks
setopt hist_verify
setopt inc_append_history
setopt share_history # share command history data

REPORTTIME=10 # print elapsed time when more than 10 seconds

setopt NO_BG_NICE # don't nice background tasks
setopt NO_HUP
setopt NO_LIST_BEEP
setopt LOCAL_OPTIONS # allow functions to have local options
setopt LOCAL_TRAPS # allow functions to have local traps
setopt PROMPT_SUBST
setopt CORRECT
setopt COMPLETE_IN_WORD
setopt IGNORE_EOF

zle -N newtab

bindkey '^[^[[D' backward-word
bindkey '^[^[[C' forward-word
bindkey '^[[5D' beginning-of-line
bindkey '^[[5C' end-of-line
bindkey '^[[3~' delete-char
bindkey '^[^N' newtab
bindkey '^?' backward-delete-char 

# use incremental search
bindkey "^R" history-incremental-search-backward

# add some readline keys back
bindkey "^A" beginning-of-line
bindkey "^E" end-of-line

# handy keybindings
bindkey "^P" history-search-backward
bindkey "^Y" accept-and-hold
bindkey "^N" history-search-forward
bindkey -s "^T" "^[Isudo ^[A" # "t" for "toughguy"

# Enable extended globbing
setopt EXTENDED_GLOB
